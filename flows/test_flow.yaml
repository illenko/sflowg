id: test_flow

entrypoint:
  type: http.post
  path: /purchase
  result: request

properties:
  payment_service_url: "http://localhost:8080/pay"
  amount: 555
  card_number: "1234 5678 1234 5678"
  expiry_date: "12/22"
  default_status: "default"

steps:
  - id: start
    type: assign
    args:
      assigned_status: properties.default_status

  - id: send_payment_request
    type: http.post
    args:
      url: properties.payment_service_url
      body:
        var_amount: properties.amount
        amount: request.body.amount
        card_number: request.body.card
        card_number_var: properties.card_number
        expiry: request.body.expiryDate
        cvv: request.body.cvv
    result: payment_response

  - id: process_payment_response
    type: switch
    args:
      - condition: payment_response.status == 200
        next: process_successful_payment
      - condition: payment_response.status == 400
        next: process_failed_payment
      - condition: true
        next: process_default_payment

  - id: process_successful_payment
    type: assign
    args:
      assigned_status: "success"

  - id: process_failed_payment
    type: assign
    args:
      assigned_status: "failed"

  - id: process_default_payment
    type: assign
    args:
      assigned_status: "default"

return:
  type: http.response
  args:
    status: 200
    body:
      status: assigned_status